container: maven:3-jdk-8

variables:
  CI_PROJECT_PATH: "ReightI/test-nucleusj-ci-cd"
  API_IMAGE_NAME: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_NAME
  VERSION: "2.0.1"

# ------------------------- Compile ----------------------------------------
# Compile the Maven project with all it's dependencies thanks to maven-assembly-plugin.


jobs:
compile:
    name : compile
    runs-on : ubuntu-latest
    
    steps :
         run: mvn versions:set -DnewVersion=$VERSION
             mvn clean package
             
      - name: target
        uses: {% data reusables.actions.action-upload-artifact %}
        with:
          path: target

# ------------------------- Deploy ----------------------------------------
# Deploy the Maven artifacts generated by "Compile" stage to Gitlab Maven repository.

  deploy:
    name: deploy
    runs-on : ubuntu-latest
    branches: [ "main" ]
    
     steps :
         run: - mvn deploy:deploy-file -Durl=https://gitlab.com/api/v4/projects/19044962/packages/maven/ -DrepositoryId=gitlab-maven -Dfile=target/NucleusJ_2-$VERSION.jar -DgroupId=burp -DartifactId=NucleusJ_2 -Dversion=$VERSION -Dpackaging=jar -DgeneratePom=false -DuniqueVersion=true -s ci_settings.xml
  

  
